## 针对瓦片的本地、HDFS、MinIO存储访问效率比较

### 环境信息

CPU：Intel(R) Core(TM) i7-10700 CPU @ 2.90GHz   2.90 GHz 4核

硬盘：Samsung SSD 970 EVO Plus 1TB

系统：NTFS

主机系统：Windows 10 IoT 企业版

运行方式：Docker 运行（此处HDFS数据没挂出来，MinIO的数据挂在本地，会导致MinIO访问较慢）

### 数据上传效率比较

| 数据        | 数据大小 | 文件数 | 本地拷贝时间/s | HDFS拷贝时间/s | HDFS访问响应时长/ms | MinIO拷贝时间/s | MinIO访问响应时长/ms |
| ----------- | -------- | ------ | -------------- | -------------- | ------------------- | --------------- | -------------------- |
| 16MB10123   | 16MB     | 10123  | 16             | 56             | 25                  | 57              | 14                   |
| 60MB40231   | 60MB     | 40231  | 73             | 219            | 21                  | 358             | 18                   |
| 222MB159966 | 222MB    | 159966 | 260            | 899            | 10                  | 1031            | 13                   |
| 600MB432882 | 600MB    | 432882 | 810            | 2356           | 16                  | 2597            | 13                   |

### 比较详情

| 方式         | 数据（数据量MB文件数） | 线程数 | 传输时间/s | 上传后文件大小 | 访问响应ms  |
| ------------ | :--------------------: | :----: | :--------: | :------------: | :---------: |
| 本地磁盘复制 |       16MB10123        |   -    |     16     |      16MB      |      -      |
|              |       60MB40231        |   -    |     73     |      60MB      |      -      |
|              |      222MB159966       |   -    |    260     |     222MB      |      -      |
|              |      600MB432882       |   -    |    810     |     600MB      |      -      |
| HDFS上传     |       16MB10123        |   1    |    148     |                | 25, 33, 243 |
|              |    16MB10123 - Pool    |   5    |     56     |                |             |
|              |    16MB10123 - Pool    |   10   |     72     |                |             |
|              |    16MB10123 - Pool    |   20   |     81     |                |             |
|              |    60MB40231 - Pool    |   5    |    219     |                | 21, 27, 13  |
|              |   222MB159966 - Pool   |   5    |    899     |                | 10, 25, 14  |
|              |   600MB432882 - Pool   |   5    |    2356    |                |  244,16,14  |
| MINIO上传    |       16MB10123        |   1    |    173     |      20Mb      | 14, 17, 13  |
|              |    16MB10123 - Pool    |   5    |     57     |      20Mb      |             |
|              |    16MB10123 - Pool    |   10   |     57     |      20Mb      |             |
|              |    16MB10123 - Pool    |   20   |     74     |      20Mb      |             |
|              |    60MB40231 - Pool    |   5    |    358     |      60Mb      | 18, 18, 18  |
|              |   222MB159966 - Pool   |   5    |    1031    |     286Mb      | 13, 14, 14  |
|              |   600MB432882 - Pool   |   5    |    2597    |     773Mb      | 13, 13, 13  |

### 结论

1. 拷贝效率上，相较于本地文件拷贝，HDFS 的上传时间约为 3 倍，MinIO 的上传时间约3.5倍；
2. 访问效率上，针对50W 瓦片数据量，HDFS 和 MinIO 访问响应时间相近，效率都很高，对业务基本无影响。HDFS 的访问响应时间约 20ms，但小概率存在部分异常时间超过200ms。MinIO 的访问响应时间约 15ms；
3. 经测试，线程保留在5个左右效率最高；
4. HDFS 和 MinIO 均有缓存机制，测试访问时采用的均为首次访问；

> 本地机器性能有限，更大数据量的测试需要测试环境支持。